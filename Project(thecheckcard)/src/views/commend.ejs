<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Commend Card</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> <!-- jQuery ë¡œë“œ -->
    <link href="https://fonts.googleapis.com/css?family=Varela+Round" rel="stylesheet">
    <style>
       body {
           background-color: #000;
           font-family: 'Varela Round', sans-serif;
           color: #fff;
           display: flex;
           align-items: center;
           justify-content: center;
           height: 100vh;
           margin: 0; /* bodyì˜ ê¸°ë³¸ ì—¬ë°± ì œê±° */
           overflow-y: auto; /* í™”ë©´ì´ ì‘ì„ ë•Œ ìŠ¤í¬ë¡¤ì„ ê°€ëŠ¥í•˜ê²Œ í•¨ */
       }

       #container {
           display: flex;
           align-items: flex-start; /* ê° ì¹´ë“œì™€ ëŒ“ê¸€ì„ ìœ„ìª½ ì •ë ¬ */
           justify-content: center;
           gap: 180px; /* ì¹´ë“œ ì‚¬ì´ì˜ ê¸°ë³¸ ê°„ê²© */
           flex-wrap: wrap; /* í™”ë©´ í¬ê¸°ì— ë”°ë¼ ì¹´ë“œê°€ ì¤„ë°”ê¿ˆë˜ë„ë¡ */
           padding: 20px; /* í™”ë©´ ìƒí•˜ë‹¨ì— ì—¬ë°±ì„ ì¶”ê°€ */
       }

       .perspective {
           width: 100%;
           perspective: 1000px;
       }

       #top {
           display: flex;
           align-items: center;
           justify-content: center;
           margin: auto;
           flex-direction: column; /* ì¹´ë“œì™€ ëŒ“ê¸€ì´ ì„¸ë¡œë¡œ ì •ë ¬ë˜ë„ë¡ */
       }

       .card {
           width: 270px;
           height: 413px;
           margin: auto;
           box-shadow: 0 70px 63px -60px #494848;
           transform-style: preserve-3d;
           transition: transform .05s linear;
           position: relative; /* ìì‹ ìš”ì†Œì˜ ìœ„ì¹˜ ì¡°ì •ì„ ìœ„í•´ position ì†ì„± ì¶”ê°€ */
       }

       .card .thumb {
           background-size: cover;
           height: 100%;
           width: 100%;
           border-radius: 15px;
           position: relative;
       }

       .card .thumb:after {
           background: inherit;
           content: '';
           display: block;
           position: absolute;
           left: -60px;
           top: 40px;
           width: 100%;
           height: 108%;
           z-index: -1;
           filter: blur(55px);
       }

       .card h2 {
           position: absolute;
           top: 20px; /* ì¹´ë“œ ë‚´ì—ì„œì˜ ìœ„ìª½ ìœ„ì¹˜ ì¡°ì • */
           left: 20px; /* ì¹´ë“œ ë‚´ì—ì„œì˜ ì™¼ìª½ ìœ„ì¹˜ ì¡°ì • */
           font-size: 30px; /* í…ìŠ¤íŠ¸ í¬ê¸° ì¡°ì • */
           font-weight: 700; /* í…ìŠ¤íŠ¸ ë‘ê»˜ ì¡°ì • */
           transform: translateZ(80px);
           margin: 0; /* ê¸°ë³¸ ë§ˆì§„ ì œê±° */
       }

       .card span {
           position: absolute;
           bottom: 20px; /* ì¹´ë“œ ë‚´ì—ì„œì˜ ì•„ë˜ìª½ ìœ„ì¹˜ ì¡°ì • */
           left: 20px; /* ì¹´ë“œ ë‚´ì—ì„œì˜ ì™¼ìª½ ìœ„ì¹˜ ì¡°ì • */
           font-size: 20px; /* í…ìŠ¤íŠ¸ í¬ê¸° ì¡°ì • */
           font-weight: 400; /* í…ìŠ¤íŠ¸ ë‘ê»˜ ì¡°ì • */
           transform: translateZ(35px);
           margin: 0; /* ê¸°ë³¸ ë§ˆì§„ ì œê±° */
       }

       .comments {
           width: 270px;
           margin-top: 50px; /* ì¹´ë“œì™€ ëŒ“ê¸€ ì‚¬ì´ì˜ ê°„ê²©ì„ ì¡°ì • */
           background: #1A1A1A;
           border-radius: 10px;
           padding: 10px;
       }

       .comment {
           margin-bottom: 10px; /* ëŒ“ê¸€ ì‚¬ì´ì˜ ê°„ê²© */
           height: 150px; /* ê° ëŒ“ê¸€ì˜ ê³ ì • ë†’ì´ */
           overflow-y: auto; /* ë‚´ìš©ì´ ë„˜ì¹  ê²½ìš° ìŠ¤í¬ë¡¤ë°” í‘œì‹œ */
           position: relative; /* ìì‹ ìš”ì†Œì˜ ìœ„ì¹˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì¡°ì •í•  ìˆ˜ ìˆë„ë¡ relative ì„¤ì • */
           display: flex; /* flexbox ì‚¬ìš© */
           flex-direction: column; /* ìš”ì†Œë¥¼ ì„¸ë¡œë¡œ ì •ë ¬ */
           justify-content: space-between; /* ìš”ì†Œë“¤ ì‚¬ì´ì˜ ê°„ê²©ì„ ê· ë“±í•˜ê²Œ ë¶„ë°° */
       }

       .comment-header {
           display: flex;
           align-items: center;
       }

       .comment-header img {
           border-radius: 50%;
           margin-right: 10px;
       }

       .comment-author {
           font-weight: bold;
           margin-right: auto;
       }

       .comment-options {
           font-size: 12px;
           color: #bbb;
       }

       .comment-body {
           margin: 10px 0;
           flex-grow: 1; /* ì¤‘ê°„ ë¶€ë¶„ì´ ë‚¨ì€ ê³µê°„ì„ ì°¨ì§€í•˜ë„ë¡ í•¨ */
       }

       .comment-footer {
           display: flex;
           align-items: center;
           justify-content: flex-start; /* ìš”ì†Œë“¤ì´ ì™¼ìª½ ì •ë ¬ë˜ë„ë¡ ì„¤ì • */
           font-size: 12px;
           flex-wrap: nowrap; /* ìš”ì†Œê°€ í•œ ì¤„ì— ë‚˜ì˜¤ë„ë¡ í•¨ */
           width: 100%; /* ë¶€ëª¨ ìš”ì†Œì˜ ë„ˆë¹„ì— ë§ê²Œ ì¡°ì • */
           padding: 5px 10px; /* ì¢Œìš° ì—¬ë°± í™•ë³´ ë° ë†’ì´ ì¶•ì†Œ */
           box-sizing: border-box; /* paddingì„ widthì— í¬í•¨ */
           background-color: #1A1A1A; /* ê¸°ë³¸ ë°°ê²½ìƒ‰ */
           min-height: 30px; /* ìµœì†Œ ë†’ì´ ì„¤ì • */
       }

       .comment-footer span {
           display: flex;
           align-items: center; /* ìì‹ ìš”ì†Œë¥¼ ìˆ˜ì§ ì¤‘ì•™ ì •ë ¬ */
           margin-left: 10px; /* ìš”ì†Œ ì‚¬ì´ì˜ ê°„ê²©ì„ ì„¤ì • */
           white-space: nowrap; /* í…ìŠ¤íŠ¸ê°€ ì¤„ë°”ê¿ˆë˜ì§€ ì•Šë„ë¡ í•¨ */
       }

       .comment-footer .likes,
       .comment-footer .comments,
       .comment-footer .comment-action {
           display: flex;
           align-items: center; /* ìì‹ ìš”ì†Œë¥¼ ìˆ˜ì§ ì¤‘ì•™ ì •ë ¬ */
           margin: 0; /* ë¶ˆí•„ìš”í•œ ë§ˆì§„ ì œê±° */
       }

       /* ë°˜ì‘í˜• ë””ìì¸ì„ ìœ„í•œ ë¯¸ë””ì–´ ì¿¼ë¦¬ */
       @media (max-width: 1300px) {
           body {
               align-items: flex-start; /* ì„¸ë¡œ ì •ë ¬ ì‹œ í™”ë©´ ìƒë‹¨ë¶€í„° ì •ë ¬ë˜ë„ë¡ */
               overflow-y: auto; /* í™”ë©´ì´ ì‘ì„ ë•Œ ìŠ¤í¬ë¡¤ì„ ê°€ëŠ¥í•˜ê²Œ í•¨ */
           }

           #container {
               gap: 20px; /* ë” ì‘ì€ í™”ë©´ì—ì„œ ì¹´ë“œ ê°„ê²© ë” ì¶•ì†Œ */
               flex-direction: column; /* ì¹´ë“œê°€ ì„¸ë¡œë¡œ ë°°ì—´ë˜ë„ë¡ ë³€ê²½ */
           }

           .card {
               width: 200px; /* ì‘ì€ í™”ë©´ì—ì„œ ì¹´ë“œ í¬ê¸° ì¡°ì • */
               height: 300px;
           }

           .card h2 {
               font-size: 24px; /* ì‘ì€ í™”ë©´ì—ì„œ í…ìŠ¤íŠ¸ í¬ê¸° ì¡°ì • */
               top: 10px; /* ì‘ì€ í™”ë©´ì—ì„œ ìœ„ì¹˜ ì¡°ì • */
               left: 10px;
           }

           .card span {
               font-size: 18px; /* ì‘ì€ í™”ë©´ì—ì„œ í…ìŠ¤íŠ¸ í¬ê¸° ì¡°ì • */
               bottom: 10px; /* ì‘ì€ í™”ë©´ì—ì„œ ìœ„ì¹˜ ì¡°ì • */
               left: 10px;
           }

           .comments {
               width: 200px; /* ì‘ì€ í™”ë©´ì—ì„œ ëŒ“ê¸€ ë°•ìŠ¤ í¬ê¸° ì¡°ì • */
               margin-top: 30px; /* ì‘ì€ í™”ë©´ì—ì„œ ì¹´ë“œì™€ ëŒ“ê¸€ ì‚¬ì´ì˜ ê°„ê²© */
           }
       }

       /* ëª¨ë‹¬ ì°½ CSS ì¶”ê°€ */
       .modal {
           display: none;
           position: fixed;
           z-index: 1;
           left: 0;
           top: 0;
           width: 100%;
           height: 100%;
           overflow: auto;
           background-color: rgb(0, 0, 0);
           background-color: rgba(0, 0, 0, 0.4);
       }

       .modal-content {
            background-color: #000000;
            margin: 15% auto;
            padding: 20px;
            border: none;
            width: 80%;
            border-radius: 10px;
            height: 80vh;
            opacity: 0.82; /* íˆ¬ëª…ë„ ì„¤ì • */
        }

       .close {
           color: #aaa;
           float: right;
           font-size: 28px;
           font-weight: bold;
       }

       .close:hover,
       .close:focus {
           color: black;
           text-decoration: none;
           cursor: pointer;
       }

       #comment-iframe {
           width: 100%;
           height: 78vh;
       }
    </style>
</head>
<body>
    <div id="container">
        <% cards.forEach(card => { %>
            <div id="top">
                <div class="perspective">
                    <div class="card" id="card1">
                        <!-- ì¹´ë“œ ì´ë¯¸ì§€ ì—¬ê¸°ì„œ ìˆ˜ì •  -->
                        <div class="thumb" data-url="/detail/<%= card.card_id %>" style="background-image: url(https://images.unsplash.com/photo-1478358161113-b0e11994a36b?ixlib=rb-0.3.5&ixid=eyJhcHBfaWQiOjEyMDd9&s=a11da19e81415e5a81029aade9df7774&auto=format&fit=crop&w=668&q=80)"></div>
                        <h2><%= card.card_name %></h2>
                        <span><%= card[`card_${category}`] %></span>
                    </div>
                    <div class="comments">
                        <% if (card.comments && card.comments.length > 0) { %>
                            <!-- ìƒìœ„ 2ê°œì˜ ëŒ“ê¸€ë§Œ ê°€ì ¸ì˜¤ê¸° -->
                            <% card.comments.slice(0, 2).forEach((comment, index) => { %>
                            <div class="comment">
                                <div class="comment-header">
                                    <% if (index === 0) { %>
                                        <span style="font-size: 40px;">ğŸ¥‡</span>
                                    <% } else if (index === 1) { %>
                                        <span style="font-size: 40px;">ğŸ¥ˆ</span>
                                    <% } else { %>
                                        <img src="https://via.placeholder.com/40" alt="Profile Image">
                                    <% } %>
                                    <div class="comment-author"><%= comment.User.nickname %></div>
                                    <div class="comment-options"><%= comment.createdAt.toLocaleDateString() %></div>
                                </div>
                                <div class="comment-body" data-card-id="<%= card.card_id %>" data-comment-id="<%= comment.comment_id %>">
                                    <%= comment.comment_contents %>
                                </div>
                                <div class="comment-footer">
                                    <span class="likes">ğŸ”¥</span> <!-- ì¢‹ì•„ìš” ìˆ˜ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ë¶€ë¶„ -->
                                    <span class="comments"><%= comment.dataValues.likeCount %></span> <!-- ëŒ“ê¸€ ìˆ˜ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ë¶€ë¶„ (í˜„ì¬ ê³ ì • ê°’) -->
                                    <span class="comment-action" data-likes="<%= comment.dataValues.likeCount %>">ì¢‹ì•„ìš”</span>
                                </div>
                            </div>
                            <% }) %>
                        <% } else { %>
                            <div class="no-comments" data-url="/comment?card_id=<%= card.card_id %>">
                                ì•„ì§ ì…ë ¥ëœ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤. ëŒ“ê¸€ ì‘ì„±í•˜ê¸°
                            </div>
                        <% } %>
                    </div>
                </div>
            </div>
        <% }) %>        
    </div>

    <!-- ëª¨ë‹¬ ì°½ HTML ì¶”ê°€ -->
    <div id="comment-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <iframe id="comment-iframe" src="" frameborder="0"></iframe>
        </div>
    </div>

    <script>
        function addCardMovement() {
            $('.card').on("mousemove", function(t) {
                var e = -($(this).width() / 2 - t.offsetX) / 10, // ì¢Œìš° ì›€ì§ì„ ì¡°ì •
                    n = ($(this).height() / 2 - t.offsetY) / 10; // ìƒí•˜ ì›€ì§ì„ ì¡°ì •
                $(this).css("transform", "rotateY(" + e + "deg) rotateX(" + n + "deg)");
            });
            $('.card').on("mouseleave", function() { // ë§ˆìš°ìŠ¤ê°€ ì¹´ë“œì—ì„œ ë²—ì–´ë‚  ë•Œ ì´ˆê¸°í™”
                $(this).css("transform", "rotateY(0deg) rotateX(0deg)");
            });
        }
        // ëª¨ë“  ì¹´ë“œì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
        addCardMovement();
        // ëª¨ë‹¬ ì°½ ì—´ê¸°
        const openModal = (url) => {
            const modal = document.getElementById("comment-modal");
            const iframe = document.getElementById("comment-iframe");
            iframe.src = url;
            modal.style.display = "block";
        };
        // ëª¨ë‹¬ ì°½ ë‹«ê¸°
        const closeModal = () => {
            const modal = document.getElementById("comment-modal");
            modal.style.display = "none";
            location.reload(); // ëª¨ë‹¬ ì°½ ë‹«ì„ ë•Œ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
        };
        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
        document.querySelectorAll('.comment-body').forEach(comment => {
            comment.addEventListener('click', (event) => {
                const cardId = comment.getAttribute('data-card-id');
                openModal(`/comment?card_id=${cardId}`);
            });
        });
        document.querySelector('.close').addEventListener('click', closeModal);
        window.addEventListener('click', (event) => {
            const modal = document.getElementById("comment-modal");
            if (event.target === modal) {
                closeModal();
            }
        });
        window.addEventListener("DOMContentLoaded", (event) => {
            const cards = document.querySelectorAll(".thumb");
            cards.forEach((e) => {
                // ì¹´ë“œ í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
                // ì¹´ë“œë¥¼ í´ë¦­í–ˆì„ ë•Œ data-url ì†ì„±ì— ì§€ì •ëœ URLë¡œ ì´ë™
                e.addEventListener("click", (event) => {
                    const url = e.getAttribute("data-url");
                    if (url) {
                        window.location.href = url;
                    }
                });
            });
            // ìƒˆë¡­ê²Œ ì¶”ê°€ëœ ì½”ë“œ: .no-comments ìš”ì†Œ í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            const noComments = document.querySelectorAll('.no-comments');
            noComments.forEach(noComment => {
                noComment.addEventListener('click', (event) => {
                    const url = noComment.getAttribute("data-url");
                    if (url) {
                        openModal(url);
                    }
                });
            });
        });
          // ëª¨ë‹¬ ì°½ì—ì„œ ë©”ì‹œì§€ ìˆ˜ì‹ 
          window.addEventListener('message', (event) => {
            if (event.data === 'reload') {
                location.reload();
            } else if (event.data === 'login') {
                window.location.href = '/user/login';
            }
        })
    </script>
</body>
</html>
